<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="boardMapper">

<!-- 게시판 글 작성 -->
<insert id="insert">
	INSERT INTO MP_BOARD(BNO, TITLE, CONTENT, WRITER)
	VALUES(MP_BOARD_SEQ.NEXTVAL, #{title}, #{content}, #{writer})
</insert>

<!-- 목록 조회 기본값.
<select id="list" resultType = "com.project.board.vo.BoardVO">
	SELECT BNO, TITLE, WRITER, REGDATE
	FROM MP_BOARD
	ORDER BY BNO DESC
</select>
-->

<!-- 목록 조회 페이징 수정-->
<select id="listPage" resultType="com.project.board.vo.BoardVO" parameterType="com.project.board.vo.SearchCriteria">
		SELECT  BNO, 
		        TITLE, 
		        CONTENT,
		        WRITER, 
		        REGDATE
		 FROM ( 
		        SELECT BNO, 
		               TITLE, 
		               CONTENT, 
		               WRITER, 
		               REGDATE, 
		               ROW_NUMBER() OVER(ORDER BY BNO DESC) AS RNUM
		         FROM MP_BOARD
		         WHERE 1=1
		         	<include refid="search"></include> 
		                       ) MP
		WHERE RNUM BETWEEN #{rowStart} AND #{rowEnd}
		ORDER BY BNO DESC
</select>

<!-- 페이지 카운트 -->
<select id="listCount" parameterType = "com.project.board.vo.SearchCriteria" resultType="int">
	
		SELECT COUNT(BNO)
		  FROM MP_BOARD
		 WHERE 1=1
		 <include refid="search"></include>
		 AND BNO > 0	
</select>
<!-- 검색기능을 위한 동적 query -->
<sql id = "search">
	<if test = "searchType != null">
		<if test = "searchType == 't'.toString()">AND TITLE LIKE '%' || #{keyword} || '%'</if>
		<if test = "searchType == 'c'.toString()">AND CONTENT LIKE '%' || #{keyword} || '%'</if>
		<if test = "searchType == 'w'.toString()">AND WRITER LIKE '%' || #{keyword} || '%'</if>
		<if test = "searchType == 'tc'.toString()">AND (TITLE LIKE '%' || #{keyword} || '%') or (CONTENT LIKE '%' || #{keyword} || '%')</if>
	</if>
</sql>

<!-- 게시물 읽기 -->
<select id = "read" parameterType = "int" resultType = "com.project.board.vo.BoardVO">
	SELECT BNO, TITLE, CONTENT, WRITER, REGDATE
	FROM MP_BOARD
	WHERE BNO = #{bno}
</select>

<!-- 게시물 수정 -->
<update id = "update" parameterType = "com.project.board.vo.BoardVO">
	UPDATE MP_BOARD
	SET TITLE = #{title},
		CONTENT = #{content}
	WHERE BNO = #{bno}
</update>

<!-- 게시물 삭제 -->
<delete id = "delete" parameterType = "int">
	DELETE
	FROM MP_BOARD
	WHERE BNO = #{bno}
</delete>
   
</mapper>